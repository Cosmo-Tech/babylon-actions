name: 'AST Action'
description: 'ADT instance deployment'
inputs:
  folder:
    description: 'Working-dir folder'
    required: true
    default: 'personal'
  team_id:
    description: 'azure team id'
    required: true
    default: ''
runs:
  using: "composite"
  steps:
    - name: creation adt instance with permissions
      run: |
        cd ${{ inputs.folder }}
        babylon azure adt instance create -s
      shell: bash

    - name: add permissions Reader
      run: |
        cd ${{ inputs.folder }}
        babylon azure permission set -rt Microsoft.DigitalTwins/digitalTwinsInstances -ri d57506d4-4c8d-48b1-8587-93c323f6a5a3
      shell: bash

    - name: add permissions Owner
      run: |
        cd ${{ inputs.folder }}
        babylon azure permission set -rt Microsoft.DigitalTwins/digitalTwinsInstances -ri bcd981a7-7f74-457b-83e1-cceb9e632ffe
      shell: bash

    - name: add permissions Owner and Reader
      run: |
        cd ${{ inputs.folder }}
        babylon azure permission set -pi ${{ inputs.team_id }} -pt Group -rt Microsoft.DigitalTwins/digitalTwinsInstances -ri bcd981a7-7f74-457b-83e1-cceb9e632ffe
        babylon azure permission set -pi ${{ inputs.team_id }} -pt Group -rt Microsoft.DigitalTwins/digitalTwinsInstances -ri d57506d4-4c8d-48b1-8587-93c323f6a5a3
      shell: bash

    - name: run script
      env:
        DTDL: ${{ github.action_path }}/../../../dtdl
      run: |
        cd ${{ inputs.folder }}
        babylon azure adt model upload $DTDL
      shell: bash